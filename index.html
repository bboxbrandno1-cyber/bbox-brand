<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>BBOX BRAND | The Absolute Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;700;900&display=swap" rel="stylesheet">
    
    <!-- Dependencies -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root {
            --obsidian: #050505;
            --zinc: #ffffff;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--obsidian);
            color: var(--zinc);
            margin: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            cursor: default !important;
            user-select: none;
        }

        /* Grainy Film Overlay - Signature Aesthetic */
        body::after {
            content: "";
            position: fixed;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background-image: url("https://upload.wikimedia.org/wikipedia/commons/7/76/1k_Grain_Noise.jpg");
            opacity: 0.04;
            pointer-events: none;
            z-index: 9999;
            animation: grain 8s steps(10) infinite;
        }

        @keyframes grain {
            0%, 100% { transform:translate(0, 0); }
            10% { transform:translate(-5%, -10%); }
            20% { transform:translate(-15%, 5%); }
            30% { transform:translate(7%, -25%); }
            40% { transform:translate(-5%, 25%); }
            50% { transform:translate(-15%, 10%); }
            60% { transform:translate(15%, 0%); }
            70% { transform:translate(0%, 15%); }
            80% { transform:translate(3%, 35%); }
            90% { transform:translate(-10%, 10%); }
        }

        .luxury-text {
            text-transform: uppercase;
            letter-spacing: 0.5em;
            font-weight: 900;
        }

        .text-glow {
            text-shadow: 0 4px 15px rgba(0,0,0,1), 0 0 40px rgba(0,0,0,0.8);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .reveal-zoom {
            animation: revealZoom 2.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes revealZoom {
            from { transform: scale(1.05); opacity: 0; filter: blur(10px); }
            to { transform: scale(1); opacity: 1; filter: blur(0); }
        }

        .nav-blur {
            backdrop-filter: blur(25px);
            background: rgba(5, 5, 5, 0.9);
        }

        .hover-reveal {
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .group:hover .hover-reveal {
            opacity: 1;
        }

        .hero-title {
            font-size: clamp(2rem, 8vw, 4.5rem);
            line-height: 1.2;
            letter-spacing: 0.8em;
        }

        .sold-out-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }
    </style>
<script type="importmap">
{
  "imports": {
    "firebase/": "https://esm.sh/firebase@^12.9.0/",
    "react": "https://esm.sh/react@^19.2.4",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyCMSAjTaf9FK2YTgfFpt8kXC4XClAoHHdw",
            authDomain: "bboxbrand-b7f60.firebaseapp.com",
            projectId: "bboxbrand-b7f60",
            storageBucket: "bboxbrand-b7f60.firebasestorage.app",
            messagingSenderId: "678435815084",
            appId: "1:678435815084:web:dd52ee29b19adea3146989"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Haptic Feedback Helper
        const triggerHaptic = () => {
            if ("vibrate" in navigator) {
                navigator.vibrate(15);
            }
        };

        // --- COMPONENTS ---

        const EagleLogo = ({ className }) => (
            <svg viewBox="0 0 400 450" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M200 20L40 80V180C40 280 200 420 200 420C200 420 360 280 360 180V80L200 20Z" stroke="currentColor" strokeWidth="6" />
                <path d="M200 120C200 120 180 130 160 110C140 90 80 100 60 140C120 130 160 160 180 200L200 250L220 200C240 160 280 130 340 140C320 100 260 90 240 110C220 130 200 120 200 120Z" fill="currentColor" />
                <g transform="translate(130, 260) scale(0.6)">
                    <path d="M0 20H60M10 40H70M20 60H80" stroke="currentColor" strokeWidth="8" strokeLinecap="round" />
                    <path d="M90 10H140C160 10 170 25 170 40C170 55 160 70 140 70H90V10Z" fill="currentColor" />
                    <path d="M180 10H230C250 10 260 25 260 40C260 55 250 70 230 70H180V10Z" fill="currentColor" />
                </g>
            </svg>
        );

        const Navbar = ({ cartCount, onCartOpen, isMuted, onToggleMute }) => {
            const [scrolled, setScrolled] = useState(false);
            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 50);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            return (
                <nav className={`fixed top-0 w-full z-50 transition-all duration-1000 ${scrolled ? 'nav-blur h-16 md:h-20 border-b border-white/5' : 'h-24 md:h-32 bg-transparent'}`}>
                    <div className="max-w-[1700px] mx-auto h-full px-6 md:px-20 flex justify-between items-center">
                        <div onClick={() => { triggerHaptic(); window.scrollTo({top: 0, behavior: 'smooth'}); }} className="flex items-center space-x-4 md:space-x-8 cursor-pointer group">
                            <EagleLogo className="w-8 h-8 md:w-10 md:h-10 text-white drop-shadow-2xl" />
                            <span className="luxury-text text-xs md:text-xl tracking-[0.5em] text-white text-glow hidden sm:block">BBOX BRAND</span>
                        </div>
                        
                        <div className="flex items-center space-x-6 md:space-x-12">
                            <button onClick={() => { triggerHaptic(); onToggleMute(); }} className="group relative">
                                <span className="luxury-text text-[9px] md:text-[11px] text-white text-glow opacity-60 group-hover:opacity-100 transition-all">
                                    {isMuted ? 'UNMUTE' : 'MUTE'}
                                </span>
                            </button>
                            
                            <button onClick={() => { triggerHaptic(); onCartOpen(); }} className="relative group flex items-center space-x-2 md:space-x-4">
                                <span className="luxury-text text-[10px] md:text-sm text-white text-glow">BAG</span>
                                {cartCount > 0 && (
                                    <span className="bg-white text-black text-[9px] font-black w-5 h-5 flex items-center justify-center rounded-full">
                                        {cartCount}
                                    </span>
                                )}
                            </button>
                        </div>
                    </div>
                </nav>
            );
        };

        const Cart = ({ isOpen, setIsOpen, cart, removeFromCart, updateQty, total, config }) => {
            if (!isOpen) return null;
            const handleConfirmOrder = () => {
                triggerHaptic();
                let message = `*NEW ORDER - BBOX BRAND*%0A%0A`;
                cart.forEach((item, index) => {
                    message += `${index + 1}. *${item.name}*%0A   Qty: ${item.qty}%0A   Price: Rs.${item.price.toLocaleString()}%0A%0A`;
                });
                message += `*Total:* Rs.${total.toLocaleString()}%0A%0A${config.message || 'Assalam-o-Alaikum BBOX, I want to buy these articles.'}`;
                window.open(`https://wa.me/${config.whatsapp || '923358211166'}?text=${message}`, '_blank');
            };

            return (
                <div className="fixed inset-0 z-[100] flex justify-end">
                    <div className="absolute inset-0 bg-black/80 backdrop-blur-md" onClick={() => setIsOpen(false)} />
                    <div className="relative w-full max-w-lg bg-white h-full shadow-2xl flex flex-col">
                        <div className="p-8 border-b flex justify-between items-center">
                            <h2 className="luxury-text text-xl text-black">BAG</h2>
                            <button onClick={() => setIsOpen(false)} className="text-black text-2xl">×</button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-8 space-y-8 no-scrollbar">
                            {cart.length === 0 ? <p className="text-zinc-400 text-center luxury-text mt-20 opacity-30">Archive Empty</p> : cart.map(item => (
                                <div key={item.id} className="flex space-x-4 border-b pb-8">
                                    <img src={item.imageUrl} className="w-20 h-28 object-cover grayscale" />
                                    <div className="flex-1 flex flex-col justify-between">
                                        <div className="flex justify-between">
                                            <h4 className="luxury-text text-[11px] text-black">{item.name}</h4>
                                            <button onClick={() => { triggerHaptic(); removeFromCart(item.id); }} className="text-zinc-300 hover:text-black">×</button>
                                        </div>
                                        <div className="flex justify-between items-end">
                                            <div className="flex items-center space-x-4 border px-2 py-1 text-black text-xs font-bold">
                                                <button onClick={() => { triggerHaptic(); updateQty(item.id, -1); }}>-</button>
                                                <span>{item.qty}</span>
                                                <button onClick={() => { triggerHaptic(); updateQty(item.id, 1); }}>+</button>
                                            </div>
                                            <p className="luxury-text text-sm text-black">Rs.{(item.price * item.qty).toLocaleString()}</p>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        {cart.length > 0 && (
                            <div className="p-8 border-t bg-zinc-50 space-y-4">
                                <div className="flex justify-between items-center">
                                    <span className="luxury-text text-[10px]">Total</span>
                                    <span className="luxury-text text-2xl text-black">Rs.{total.toLocaleString()}</span>
                                </div>
                                <button onClick={handleConfirmOrder} className="w-full bg-black text-white py-6 luxury-text text-sm hover:bg-zinc-800 transition-all font-black">CHECKOUT VIA WHATSAPP</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const StoreView = ({ products, activeCat, setActiveCat, addToCart, loading, config }) => {
            const videoRef = useRef(null);

            useEffect(() => {
                if (videoRef.current) {
                    videoRef.current.play().catch(e => console.log("Video Play Error:", e));
                }
            }, []);

            const handleCategorySelect = (cat) => {
                triggerHaptic();
                setActiveCat(cat);
                const target = document.getElementById('archive');
                if (target) target.scrollIntoView({ behavior: 'smooth' });
            };

            const handleDirectOrder = (p) => {
                triggerHaptic();
                const prefix = config.message || 'Assalam-o-Alaikum BBOX, I want to order';
                const message = `${prefix} ${p.name}.`;
                window.open(`https://wa.me/${config.whatsapp || '923358211166'}?text=${encodeURIComponent(message)}`, '_blank');
            };

            const categories = ['ALL', ...(config.categories || ['T-SHIRTS', 'TRACK SUITS', 'HOODIES', 'SWEATERS'])];

            return (
                <div className="relative">
                    <header className="relative h-screen flex items-center justify-center overflow-hidden">
                        <div className="absolute inset-0 z-0">
                            <video ref={videoRef} autoPlay muted loop playsInline className="w-full h-full object-cover grayscale contrast-125 brightness-[0.3]">
                                <source src="https://assets.mixkit.co/videos/preview/mixkit-fashion-model-walking-in-a-dark-room-41315-large.mp4" type="video/mp4" />
                            </video>
                        </div>
                        
                        <div className="relative z-10 flex flex-col items-center text-center px-4 w-full">
                            <div className="w-32 md:w-60 mb-10 md:mb-16">
                                <EagleLogo className="w-full h-auto text-white opacity-100 drop-shadow-[0_0_40px_rgba(0,0,0,1)]" />
                            </div>
                            <h1 className="luxury-text hero-title text-white text-glow mb-16 md:mb-24 tracking-[0.8em]">BBOX BRAND</h1>
                            
                            <div className="w-full overflow-x-auto no-scrollbar flex flex-nowrap md:flex-wrap justify-start md:justify-center gap-8 md:gap-16 px-6 pb-6">
                                {categories.map(cat => (
                                    <button 
                                        key={cat} 
                                        onClick={() => handleCategorySelect(cat)} 
                                        className={`luxury-text text-[10px] md:text-lg text-glow transition-all duration-700 whitespace-nowrap ${activeCat === cat ? 'text-white border-b-2 border-white pb-2' : 'text-zinc-600 hover:text-white'}`}
                                    >
                                        {cat}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="absolute bottom-10 w-full text-center z-10">
                            <p className="luxury-text text-[10px] text-zinc-600 text-glow animate-bounce">SCROLL ARCHIVE</p>
                        </div>
                    </header>

                    <main id="archive" className="max-w-[1700px] mx-auto px-6 md:px-20 py-24 md:py-48">
                        <div className="flex flex-col md:flex-row justify-between items-center mb-24 md:mb-40 gap-8 border-b border-zinc-900 pb-12">
                            <div className="w-full md:w-auto overflow-x-auto no-scrollbar flex space-x-10 md:space-x-16 scroll-smooth">
                                {categories.map(cat => (
                                    <button 
                                        key={cat} 
                                        onClick={() => { triggerHaptic(); setActiveCat(cat); }} 
                                        className={`luxury-text text-xs md:text-sm whitespace-nowrap transition-all duration-500 ${activeCat === cat ? 'text-white' : 'text-zinc-800 hover:text-zinc-400'}`}
                                    >
                                        {cat}
                                    </button>
                                ))}
                            </div>
                            <p className="luxury-text text-[10px] text-zinc-900 hidden md:block">[{products.length} ARTICLES]</p>
                        </div>

                        {loading ? <div className="h-64 flex items-center justify-center"><div className="w-10 h-10 border-2 border-white/10 border-t-white rounded-full animate-spin"></div></div> : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-10 gap-y-24 md:gap-y-40">
                                {products.map((p) => {
                                    const isSoldOut = p.stock === 0 || p.stock === "0";
                                    return (
                                        <div key={p.id} className="group">
                                            <div className="relative aspect-[3/4] overflow-hidden bg-[#0a0a0a]">
                                                <img src={p.imageUrl} className={`w-full h-full object-cover grayscale brightness-100 transition-all duration-1000 ${!isSoldOut ? 'group-hover:scale-110 group-hover:grayscale-0' : 'opacity-40'}`} />
                                                
                                                {isSoldOut ? (
                                                    <div className="absolute inset-0 flex items-center justify-center z-20 sold-out-overlay">
                                                        <p className="luxury-text text-white text-[10px] tracking-[1em] border border-white/20 px-4 py-2">SOLD OUT</p>
                                                    </div>
                                                ) : (
                                                    <div className="absolute inset-0 bg-black/80 hover-reveal flex flex-col items-center justify-center p-10 text-center">
                                                        <p className="luxury-text text-2xl mb-10 text-white text-glow">Rs.{p.price.toLocaleString()}</p>
                                                        <div className="flex flex-col w-full space-y-4">
                                                            <button onClick={() => { triggerHaptic(); addToCart(p); }} className="luxury-text text-[10px] border border-white/40 px-8 py-4 hover:bg-white hover:text-black transition-all">ADD TO BAG</button>
                                                            <button onClick={() => handleDirectOrder(p)} className="luxury-text text-[9px] text-zinc-500 hover:text-white underline underline-offset-4">WHATSAPP ORDER</button>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                            <div className="mt-8 text-center">
                                                <h3 className="luxury-text text-[11px] text-white text-glow mb-2">{p.name}</h3>
                                                <p className="luxury-text text-[9px] text-zinc-800">{p.category}</p>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const Footer = ({ config }) => (
            <footer className="bg-black text-white pt-32 pb-16 px-6 border-t border-zinc-900">
                <div className="max-w-7xl mx-auto space-y-20">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-16 text-center md:text-left">
                        <div className="space-y-6">
                            <h4 className="luxury-text text-xl tracking-[0.8em]">BBOX</h4>
                            <p className="text-[9px] text-zinc-700 luxury-text leading-relaxed max-w-xs mx-auto md:mx-0">High-End Minimalist Archives. Crafted for Excellence.</p>
                        </div>
                        <div className="hidden md:block">
                            <h5 className="luxury-text text-[10px] text-zinc-800 mb-8">Navigation</h5>
                            <ul className="text-[9px] text-zinc-600 space-y-4 luxury-text">
                                {(config.categories || []).map(c => <li key={c} className="hover:text-white transition-colors cursor-pointer">{c}</li>)}
                            </ul>
                        </div>
                        <div className="space-y-8">
                            <h5 className="luxury-text text-[10px] text-zinc-800 mb-8">Contact HQ</h5>
                            <p className="text-[9px] text-zinc-600 luxury-text">+{config.whatsapp || '923358211166'}</p>
                        </div>
                    </div>
                    <div className="pt-10 border-t border-zinc-950 flex flex-col md:flex-row justify-between items-center text-[8px] text-zinc-900 luxury-text">
                        <p>&copy; 2024 BBOX BRAND INT.</p>
                        <div className="flex space-x-10 mt-4 md:mt-0"><span>PRIVACY</span><span>HQ SECURITY</span></div>
                    </div>
                </div>
            </footer>
        );

        // --- MAIN APP ---
        const App = () => {
            const [products, setProducts] = useState([]);
            const [config, setConfig] = useState({ categories: [], whatsapp: '923358211166', message: 'Assalam-o-Alaikum BBOX, I want to order' });
            const [cart, setCart] = useState([]);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [activeCat, setActiveCat] = useState('ALL');
            const [loading, setLoading] = useState(true);
            const [isPreloading, setIsPreloading] = useState(true);
            const [hasInteracted, setHasInteracted] = useState(false);
            const [isMuted, setIsMuted] = useState(true);
            const audioRef = useRef(null);

            useEffect(() => {
                const timer = setTimeout(() => setIsPreloading(false), 2000);
                return () => clearTimeout(timer);
            }, []);

            useEffect(() => {
                const handleStartMedia = () => {
                    if (!hasInteracted && audioRef.current) {
                        audioRef.current.volume = 0.2;
                        audioRef.current.play().catch(e => console.log("Audio play blocked", e));
                        setHasInteracted(true);
                        setIsMuted(false);
                        audioRef.current.muted = false;
                    }
                };
                window.addEventListener('click', handleStartMedia, { once: true });
                window.addEventListener('touchstart', handleStartMedia, { once: true });
                window.addEventListener('scroll', handleStartMedia, { once: true });
                return () => {
                    window.removeEventListener('click', handleStartMedia);
                    window.removeEventListener('touchstart', handleStartMedia);
                    window.removeEventListener('scroll', handleStartMedia);
                };
            }, [hasInteracted]);

            useEffect(() => {
                const unsubProducts = db.collection('products').orderBy('createdAt', 'desc')
                    .onSnapshot(snapshot => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setProducts(data);
                        setLoading(false);
                    }, () => {
                        setLoading(false);
                    });
                
                const unsubConfig = db.collection('config').doc('main').onSnapshot(doc => {
                    if (doc.exists) setConfig(doc.data());
                });

                return () => { unsubProducts(); unsubConfig(); };
            }, []);

            const addToCart = (p) => {
                setCart(prev => {
                    const ex = prev.find(i => i.id === p.id);
                    if (ex) return prev.map(i => i.id === p.id ? {...i, qty: i.qty + 1} : i);
                    return [...prev, { ...p, qty: 1 }];
                });
                setIsCartOpen(true);
            };

            const toggleMute = () => {
                if (audioRef.current) {
                    audioRef.current.muted = !isMuted;
                    setIsMuted(!isMuted);
                }
            };

            const cartTotal = cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
            const filtered = activeCat === 'ALL' ? products : products.filter(p => p.category === activeCat);

            return (
                <div className="min-h-screen bg-[#050505]">
                    <audio ref={audioRef} loop src="https://assets.mixkit.co/music/preview/mixkit-mysterious-drone-ambience-772.mp3" preload="auto" muted></audio>

                    {isPreloading ? (
                        <div className="h-screen w-full flex items-center justify-center bg-[#050505] fixed inset-0 z-[1000]">
                            <div className="flex flex-col items-center space-y-4">
                                <EagleLogo className="w-16 h-16 text-white opacity-20 animate-pulse" />
                                <p className="luxury-text text-[10px] animate-pulse text-white text-glow tracking-[1.5em]">BBOX LOADING...</p>
                            </div>
                        </div>
                    ) : (
                        <div className="reveal-zoom">
                            <Navbar 
                                cartCount={cart.reduce((a, c) => a + c.qty, 0)} 
                                onCartOpen={() => setIsCartOpen(true)}
                                isMuted={isMuted}
                                onToggleMute={toggleMute}
                            />
                            <Cart 
                                isOpen={isCartOpen} 
                                setIsOpen={setIsCartOpen} 
                                cart={cart} config={config}
                                removeFromCart={id => setCart(prev => prev.filter(i => i.id !== id))} 
                                updateQty={(id, d) => setCart(prev => prev.map(i => i.id === id ? {...i, qty: Math.max(1, i.qty+d)} : i))} 
                                total={cartTotal} 
                            />
                            <StoreView 
                                products={filtered} 
                                activeCat={activeCat} 
                                setActiveCat={setActiveCat} 
                                addToCart={addToCart} 
                                loading={loading} 
                                config={config}
                            />
                            <Footer config={config} />
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
